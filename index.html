<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Piggy Budget</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        select,
        input,
        button {
            width: 100%;
            padding: 12px;
            box-sizing: border-box;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 10px;
        }

        button {
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #fff);
            border: none;
            font-weight: bold;
            cursor: pointer;
            padding: 15px;
        }

        .type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .type-btn {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            text-align: center;
            cursor: pointer;
        }

        .type-btn.active {
            background: var(--tg-theme-button-color, #3390ec);
            color: #fff;
        }
    </style>
</head>

<body>
    <div class="type-selector">
        <div class="type-btn active" onclick="setType('expense')" id="btn-expense">–†–∞—Å—Ö–æ–¥</div>
        <div class="type-btn" onclick="setType('income')" id="btn-income">–î–æ—Ö–æ–¥</div>
    </div>

    <label>–°—É–º–º–∞</label>
    <input type="number" id="amount" placeholder="0" inputmode="decimal">

    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
    <select id="category">
        <option value="–ü—Ä–æ–¥—É–∫—Ç—ã –∏ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞ üõí">–ü—Ä–æ–¥—É–∫—Ç—ã üõí</option>
        <option value="–°–µ–º–µ–π—Å—Ç–≤–æ üè†">–°–µ–º–µ–π—Å—Ç–≤–æ üè†</option>
        <option value="–ñ–∏–≤–æ—Ç–Ω—ã–µ üêæ">–ñ–∏–≤–æ—Ç–Ω—ã–µ üêæ</option>
        <option value="–ö—Ä–∞—Å–æ—Ç–∞ ‚ú®">–ö—Ä–∞—Å–æ—Ç–∞ ‚ú®</option>
        <option value="–ó–¥–æ—Ä–æ–≤—å–µ üíä">–ó–¥–æ—Ä–æ–≤—å–µ üíä</option>
        <option value="–û–¥–µ–∂–¥–∞ üëó">–û–¥–µ–∂–¥–∞ üëó</option>
        <option value="–ê–≤—Ç–æ üöó">–ê–≤—Ç–æ üöó</option>
        <option value="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç üöï">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç üöï</option>
        <option value="–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è üçø">–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è üçø</option>
        <option value="–¶–∏—Ñ—Ä–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ üì±">–¶–∏—Ñ—Ä–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ üì±</option>
        <option value="–ö–≤–∞—Ä—Ç–∏—Ä–∞ üè¢">–ö–≤–∞—Ä—Ç–∏—Ä–∞ üè¢</option>
        <option value="–†–µ—Å—Ç–æ—Ä–∞–Ω—ã üçî">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã üçî</option>
        <option value="–î—Ä—É–≥–æ–µ üåÄ">–î—Ä—É–≥–æ–µ üåÄ</option>
    </select>

    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
    <input type="text" id="desc" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">

    <button type="button" onclick="sendData()">–î–û–ë–ê–í–ò–¢–¨</button>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let currentType = 'expense';
        const incomeCats = [
            { val: "–ó–∞—Ä–ø–ª–∞—Ç–∞ üí∞", text: "–ó–∞—Ä–ø–ª–∞—Ç–∞ üí∞" },
            { val: "–ö–µ—à–±—ç–∫ üí∏", text: "–ö–µ—à–±—ç–∫ üí∏" },
            { val: "–î—Ä—É–≥–æ–µ üåÄ", text: "–î—Ä—É–≥–æ–µ üåÄ" }
        ];
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤
        const expenseCatsHTML = document.getElementById('category').innerHTML;

        function setType(type) {
            currentType = type;
            document.getElementById('btn-expense').className = `type-btn ${type === 'expense' ? 'active' : ''}`;
            document.getElementById('btn-income').className = `type-btn ${type === 'income' ? 'active' : ''}`;

            const catSelect = document.getElementById('category');
            if (type === 'income') {
                catSelect.innerHTML = incomeCats.map(c => `<option value="${c.val}">${c.text}</option>`).join('');
            } else {
                catSelect.innerHTML = expenseCatsHTML;
            }
        }

        function sendData() {
            let amountVal = document.getElementById('amount').value;
            let category = document.getElementById('category').value;
            let description = document.getElementById('desc').value;

            if (!amountVal) {
                tg.showAlert("‚ùå –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É!");
                return;
            }

            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            let data = {
                type: currentType === 'expense' ? 'op_waiting_expense' : 'op_waiting_income',
                amount: parseFloat(amountVal.replace(',', '.')),
                category: category,
                description: description || "-"
            };

            // –û–¢–õ–ê–î–ö–ê: –ï—Å–ª–∏ —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç JS –∂–∏–≤
            // tg.showAlert("–û—Ç–ø—Ä–∞–≤–ª—è—é: " + JSON.stringify(data)); 

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
            tg.sendData(JSON.stringify(data));
        }
    </script>
</body>

</html>