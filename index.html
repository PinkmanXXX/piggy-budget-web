<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Piggy Budget</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        h2 {
            margin-top: 0;
            text-align: center;
        }

        label {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #888);
            margin-bottom: 5px;
            display: block;
        }

        select,
        input {
            width: 100%;
            padding: 12px;
            box-sizing: border-box;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 12px;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000);
            font-size: 16px;
            outline: none;
            margin-bottom: 10px;
            -webkit-appearance: none;
            appearance: none;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–π */
        .type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .type-btn {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid transparent;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000);
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            font-weight: 500;
        }

        .type-btn.active {
            border-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-color, #3390ec);
            background: var(--tg-theme-bg-color, #fff);
        }

        #mainBtn {
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #fff);
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <div class="type-selector">
        <div class="type-btn active" onclick="setType('expense')" id="btn-expense">–†–∞—Å—Ö–æ–¥</div>
        <div class="type-btn" onclick="setType('income')" id="btn-income">–î–æ—Ö–æ–¥</div>
    </div>

    <div>
        <label>–°—É–º–º–∞ (‚ÇΩ)</label>
        <input type="number" id="amount" placeholder="0" inputmode="decimal">
    </div>

    <div id="cat-wrapper">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="category">
            <option value="–ü—Ä–æ–¥—É–∫—Ç—ã –∏ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞ üõí">–ü—Ä–æ–¥—É–∫—Ç—ã –∏ —Ç–æ–≤–∞—Ä—ã üõí</option>
            <option value="–°–µ–º–µ–π—Å—Ç–≤–æ üè†">–°–µ–º–µ–π—Å—Ç–≤–æ üè†</option>
            <option value="–ñ–∏–≤–æ—Ç–Ω—ã–µ üêæ">–ñ–∏–≤–æ—Ç–Ω—ã–µ üêæ</option>
            <option value="–ö—Ä–∞—Å–æ—Ç–∞ ‚ú®">–ö—Ä–∞—Å–æ—Ç–∞ ‚ú®</option>
            <option value="–ó–¥–æ—Ä–æ–≤—å–µ üíä">–ó–¥–æ—Ä–æ–≤—å–µ üíä</option>
            <option value="–û–¥–µ–∂–¥–∞ üëó">–û–¥–µ–∂–¥–∞ üëó</option>
            <option value="–ê–≤—Ç–æ üöó">–ê–≤—Ç–æ üöó</option>
            <option value="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç üöï">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç üöï</option>
            <option value="–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è üçø">–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è üçø</option>
            <option value="–¶–∏—Ñ—Ä–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ üì±">–¶–∏—Ñ—Ä–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ üì±</option>
            <option value="–¶–∏—Ñ—Ä–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã üíª">–¶–∏—Ñ—Ä–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã üíª</option>
            <option value="–ö–≤–∞—Ä—Ç–∏—Ä–∞ üè¢">–ö–≤–∞—Ä—Ç–∏—Ä–∞ üè¢</option>
            <option value="–î—Ä—É–≥–æ–µ üåÄ">–î—Ä—É–≥–æ–µ üåÄ</option>
        </select>
    </div>

    <div>
        <label>–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <input type="text" id="desc" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê—à–∞–Ω">
    </div>

    <button id="mainBtn" onclick="sendData()">–î–æ–±–∞–≤–∏—Ç—å</button>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞—Å–∫—Ä—ã—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        let currentType = 'expense';

        const incomeCats = [
            { val: "–ó–∞—Ä–ø–ª–∞—Ç–∞ üí∞", text: "–ó–∞—Ä–ø–ª–∞—Ç–∞ üí∞" },
            { val: "–ö–µ—à–±—ç–∫ üí∏", text: "–ö–µ—à–±—ç–∫ üí∏" },
            { val: "–°—é—Ä–ø—Ä–∏–∑ üéÅ", text: "–°—é—Ä–ø—Ä–∏–∑ üéÅ" },
            { val: "–î—Ä—É–≥–æ–µ üåÄ", text: "–î—Ä—É–≥–æ–µ üåÄ" }
        ];

        const expenseCatsHTML = document.getElementById('category').innerHTML;

        function setType(type) {
            currentType = type;
            document.getElementById('btn-expense').className = `type-btn ${type === 'expense' ? 'active' : ''}`;
            document.getElementById('btn-income').className = `type-btn ${type === 'income' ? 'active' : ''}`;

            const catSelect = document.getElementById('category');
            if (type === 'income') {
                catSelect.innerHTML = incomeCats.map(c => `<option value="${c.val}">${c.text}</option>`).join('');
            } else {
                catSelect.innerHTML = expenseCatsHTML;
            }
        }

        function sendData() {
            let amount = document.getElementById('amount').value;
            let category = document.getElementById('category').value;
            let description = document.getElementById('desc').value;

            if (!amount) {
                tg.showAlert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É!");
                return;
            }

            let data = {
                type: currentType === 'expense' ? 'op_waiting_expense' : 'op_waiting_income',
                amount: parseFloat(amount.replace(',', '.')),
                category: category,
                description: description || "-"
            };

            tg.sendData(JSON.stringify(data));
        }
    </script>
</body>

</html>